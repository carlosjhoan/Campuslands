<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabor Casero</title>
    <link rel="stylesheet" href="delivery_style.css">
    <link rel="shortcut icon" href="../img_proyecto/logo.ico">
    

</head>
<body>


    <nav>
        <div class="grid nav">
            <div class="logo">
                <a href="https://carlosjhoan.github.io/Campuslands/HTML&CSS/sabor_casero/inicio.html"><img src="../img_proyecto/logo_tranparent.png" alt=""></a>
            </div>

            <div class="buscar">
                <form action = "https://www.google.com/search" method = "get">
                    <label for="search"><img src="../img_proyecto/search_logo.png" alt="search"></label>
                    <input type="search" name = "q" id = "search" placeholder="Buscar">
                </form>
            </div>

            <div id = "buy_car">
                <div id = "img_car">
                    <img src="../img_proyecto/buy_car.png" alt="Buy_car">
                </div>
                <div id = "mi_pedido">
                    <input type="text"  readonly id = "value_order">
                    <button id = "button_mi_pedido" onclick="dropdown_order ()">Ver pedido</button>
                </div>
                
            </div>
            
            <div class="barr_nav">
                <div class="menu"><button><img src="../img_proyecto/menu_logo.png" alt=""></button></div>
                <ul>
                    <li class = "menu_dia"><a href="https://carlosjhoan.github.io/Campuslands/HTML&CSS/sabor_casero/menu.html">Menú</a></li>
                    <li><a href="https://carlosjhoan.github.io/Campuslands/HTML&CSS/sabor_casero/nosotros.html">Nosotros</a></li>
                    <li><a href="https://carlosjhoan.github.io/Campuslands/HTML&CSS/sabor_casero/contacto.html">Contáctanos</a></li>
                </ul>

            </div>
        </div>
    </nav>

    <main>
        
        <div class= "each gallina">
            <p class = "precio">$14.000</p>
            <img src="../img_proyecto/gallina.PNG" alt="" class = "foto">
            <p class = "dish_name">Sancocho de gallina</p>
            <div class= "hr"></div>
            <p class = "q_trae"><em>Sopa de sancocho, cuarto de gallina, yuca al vapor, arroz, ensalada con aguacate, limonada</em></p>
            <div class="button_i_want" id = "i_want_gallina">
                <button class = "i_want" id = "but_gallina" onclick = "order_buy('i_want_gallina', 'img_check_gallina', 0)">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "img_check_gallina">
            </div>
            
        </div>
        <div class="each costilla">
            <p class = "precio">$14.000</p>
            <img src="../img_proyecto/costilla.PNG" alt="" class = "foto">
            <p class = "dish_name">Sancocho de costilla</p>
            <div class= "hr"></div>
            <p class = "q_trae"><em>Sopa de sancocho, costilla guisada, yuca al vapor, arroz, ensalada con aguacate, limonada</em></p>
            <div class="button_i_want" id = "i_want_costilla">
                <button class = "i_want" id = "but_costilla" onclick="order_buy('i_want_costilla', 'img_check_costilla', 1)">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "img_check_costilla">
            </div>
            
        </div>
        <div class="each cola">
            <p class = "precio">$14.000</p>
            <img src="../img_proyecto/cola.PNG" alt="" class = "foto">
            <p class = "dish_name">Sancocho de cola</p>
            <div class= "hr"></div>
            <p class = "q_trae"><em>Sopa de sancocho, cola de res guisada, yuca al vapor, arroz, ensalada con aguacate, limonada</em></p>
            <div class="button_i_want" id = "i_want_cola">
                <button class = "i_want" id = "but_cola" onclick="order_buy('i_want_cola', 'img_check_cola', 2)">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "img_check_cola">
            </div> 
        </div>
        
        <div class="each sobrebarriga">
            <p class = "precio">$14.000</p>
            <img src="../img_proyecto/sobrebarriga.PNG" alt="" class = "foto">
            <p class = "dish_name">Sobrebarriga (160gr)</p>
            <div class= "hr"></div>
            <p class = "q_trae"><em>Sopa de fideos, yuca al vapor, papa a la francesa, arroz, ensalada con aguacate, limonada</em></p>
            <div class="button_i_want" id = "i_want_sobre">
                <button class = "i_want" id = "but_sobre" onclick="order_buy('i_want_sobre', 'img_check_sobre', 3)">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "img_check_sobre">
            </div>  
        </div>

        <div class="each chatas">
            <p class = "precio">$14.000</p>
            <img src="../img_proyecto/chatas.PNG" alt="" class = "foto">
            <p class = "dish_name">Chatas (160gr)</p>
            <div class= "hr"></div>
            <p class = "q_trae"><em>Sopa de fideos, yuca al vapor, papa a la francesa, arroz, ensalada con aguacate, limonada</em></p>
            <div class = "button_i_want" id = "i_want_chatas">
                <button class = "i_want" id = "but_chatas" onclick="order_buy('i_want_chatas', 'img_check_chatas', 4)">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "img_check_chatas">
            </div>
        </div>

        <div class="each oreada">
            <p class = "precio">$14.000</p>
            <img src="../img_proyecto/oreada.PNG" alt="" class = "foto">
            <p class = "dish_name">Oreada (160gr)</p>
            <div class= "hr"></div>
            <p class = "q_trae"><em>Sopa de fideos, yuca al vapor, papa a la francesa, arroz, ensalada con aguacate, limonada</em></p>
            <div class="button_i_want" id = "i_want_ore">
                <button class = "i_want" id = "but_oreada" onclick="order_buy('i_want_ore', 'img_check_ore', 5)">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "img_check_ore">
            </div>
        </div>

        
        
        <div class="grid legal">
            <div class="logo_legal"><img src="../img_proyecto/logo_tranparent_white.png" alt=""></div>
            <div class="terms">
                <ul>
                    <li><a href="https://www.restaurantemuy.com/terminosycondiciones" target="_blank">Términos y condiciones</a></li>
                    <li><a href="https://www.restaurantemuy.com/politicadeprivacidad" target="_blank">Política de privacidad</a></li>
                </ul>
            </div>
            <div class="social_media">
                <a href = "https://www.facebook.com/lalitoy/" target = "_blank"><img src = "../img_proyecto/facebook_logo.png" alt = "facebook">
                    <a href = "https://www.instagram.com/carlos.aguilar0512/?hl=es-la" target = "_blank"><img src = "../img_proyecto/instagram_logo.png" alt = "instagram"></a>

            </div>

        </div>
        <div class="grid footer">
            <hr>
            <p>@LaliToy. All right reserved.</p>
        </div>
    </main>

    <div class="wpp">
        <p>Escríbenos</p>
        <a href = "https://walink.co/4729de" target = "_blank"><img src = "https://github.com/carlosjhoan/Campuslands/blob/main/HTML&CSS/img/wpp_logo.png?raw=true" alt = "whatsapp"></a>
  
    </div>

    <!--Aquí viene el botón para cambiar a PICKUP-->
    <div class="buttons_deliv_pickup">
        <div class="botton_delivery"><button id = "b_delivery"><img src="../img_proyecto/food-pickup_1.png" alt=""><a href="https://carlosjhoan.github.io/Campuslands/HTML&CSS/sabor_casero/pickup.html">Paso a recoger</a><img src="../img_proyecto/food-pickup_2.png" alt=""></button></div>

    </div>

    

    <!--Aquí viene el formulario que se llena cuando confirmamos el pedido-->
    <div class="check_buy">
        <div class="titulo">
            <div class="linea"></div>
            <div class="head">Información para recogerlo</div>
            <div class="linea"></div>
        </div>
        <form action="">
            <div>
                <label for="first_name">Nombre *</label>
                <input type="text" id = "first_name" class = "input_buy" placeholder=" Digite su nombre">
            </div>           
            
           <!-- <div>
                <label for="last_name">Apellido <em>(opcional)</em></label>
                <input type="text" id = "last_name" class = "input_buy" placeholder=" Digite su apellido">
            </div>-->

            <div>
                <label for="email">Email *</label>
                <input type="email"  id = "email" class = "input_buy" placeholder=" example@this.com" >
            </div>
                
            <div>
                <label for="cell_number">Celular *</label>
                <input type="text"  id = "cell_number" class = "input_buy" placeholder=" Número de cel...">
            </div>

            <div>
                <label for="dir">Dirección *</label>
                <input type="text"  id = "dir" class = "input_buy" placeholder=" Dirección...">
            </div>
            

            <fieldset>
                <legend>¿Qué deseas que tengamos en cuenta?</legend>
                <textarea name="commit" id="commit" cols="30" rows="4"></textarea>
            </fieldset>
        </form>

        <div class="before_ready">
            <button id = "previous" onclick="previous()"><img src="../img_proyecto/previous.png" alt=""></button>
            <button type="submit" id = "listo_button" onclick="ok_my_order()"><img src="../img_proyecto/check_listo.png" alt="" id = "listo_1">Listo!<img src="../img_proyecto/confirm_order.png" alt="" id = "listo_2"></button>
        </div>
        
    </div>

    <div id="review_order">
        <div id = "review_paragraph"></div>
        <button onclick="finish()"><img src="../img_proyecto/check_green.png" alt=""></button>
    </div>

    <!--Buscar registros en la base de datos-->
    <div id ="search_database">
        <div id = "head">Tu(s) factura(s)</div>
        <div id ="div_stack">
            <div id = "slide_barr">
                <div>
                    <label for="option_search">Buscar por:</label>
                    <select name="option_search" id="option_search">
                        <option value="id">Factura</option>
                        <option value="celular">Celular</option>
                    </select>
                </div>

                <div id = "input_search">
                    <input type="text" id = "input_database" placeholder="digite info">
                    <img src="../img_proyecto/search_logo.png" id = "search_orders" alt="">
                </div>
               
            </div>
            <div id="stack_icon"><img src="../img_proyecto/database_search.png" alt=""></div>    
        </div>
    </div>

    <!--Aquí vienen la facturas en la pantalla-->

    <div class="info_database">
        <div id = "container_orders"><div id = "each_order"></div></div>
        
        <div id = "buttons_orders">
            <button id = "before_order"><img src="../img_proyecto/previous.png" alt=""></button>
            <button id = "close_order"><img src="../img_proyecto/close_order.png" alt=""></button>
            <button id = "after_order"><img src="../img_proyecto/after.png" alt=""></button>
        </div>
    </div>

    <!--Aquí viene la lista del pedido-->
    <div class = "lista_pedido">
        <table id = "table_order">
            
        </table>
        <button id = "confirmo_button" onclick="confirm_order()"><img src="../img_proyecto/order_list.png" alt="" id = "order_list">Confirmo!<img src="../img_proyecto/check_icon.png" alt="" id = "check"></button>
        <button id = "ok_button" onclick="collapse_order()"><img src="../img_proyecto/up_icon.png" alt=""></button>
    </div>

    <script>
        

        let arr_pedido = [["S. de gallina", 0,"i_want_gallina" , "img_check_gallina"],

                            ["S. de costilla", 0, "i_want_costilla" , "img_check_costilla"],

                            ["S. de cola", 0, "i_want_cola" , "img_check_cola"],

                            ["Sobrebarriga", 0, "i_want_sobre" , "img_check_sobre"],

                            ["Chatas", 0, "i_want_chatas" , "img_check_chatas"],

                            ["Oreada",  0, "i_want_ore" , "img_check_ore"],
        ]

        let data = [];
        let id_order;
        let data_facturas

        let total_price;

        window.onpageshow = function () {
            const inpu_car = document.getElementById("value_order");
            inpu_car.value = 0;

            fetch ('http://localhost:3000/orders', {
                method: 'GET',
                headers: {
                    'Content-type' : 'application/json; charset=UTF-8'
                },
            })

            .then(response => response.json())
            .then(json => {
                if (json.length == 0) {
                    id_order = 0;
                } else {
                    id_order = json.length
                }
                
                })
            
        }

        function vibrate (arr_div_id) {
            let d_C = 20;
            //const input_element = document.getElementById(div_id);
            rotate_animation = setInterval(frame, 20)
            function frame () {
                for (let i=0; i< arr_div_id.length; i++) {
                    if (d_C <= -20) {
                    document.getElementById(arr_div_id[i]).style.translate = "0px";
                    document.getElementById(arr_div_id[i]).addEventListener("click", () => {
                        document.getElementById(arr_div_id[i]).style.color = "black";
                        document.getElementById(arr_div_id[i]).style.backgroundColor = "rgb(254, 236, 236)";
                        document.getElementById(arr_div_id[i]).style.border = "2px solid";
                        
                    
                    })
                    
                    clearInterval(rotate_animation);
                    
                    
                } else {
                    d_C -= 5
                    document.getElementById(arr_div_id[i]).style.translate = d_C + "px";
                    document.getElementById(arr_div_id[i]).style.color = "red";
                    document.getElementById(arr_div_id[i]).value = "Información incorrecta";
                    
                }
                }
                
            } 

        }
 
        function order_buy (div_id, img_id, pos_arr_pedido) {
            let table = "<tr><th><b>Cant</b></th><th><b>Plato</b></th><th><b>$/unidad</b></th> <th><b>Valor</b></th><th><b>Cancelar</b></th></tr>";//
            const table_order = document.getElementById("table_order");//
            let q_orders = 0;
            let moneyFormatter  = new Intl.NumberFormat(); 
            const id_input = div_id + '_input'
            const img_check = document.getElementById(img_id);
            const div_proteina = document.querySelector(`#${div_id}`);
            const buy_car = document.getElementById("img_car");
            const value_order = document.getElementById("value_order");
            const but_mi_pedido = document.getElementById("button_mi_pedido");
            but_mi_pedido.style.width = "80px";
            buy_car.style["background-color"] = "rgb(69, 244, 69)";
            value_order.style["background-color"] = "rgb(5, 132, 5)";
            value_order.style.border = "1px rgb(5, 132, 5)";
            value_order.style.width = "100px";
            but_mi_pedido.style.visibility = "visible";
            const div_quantity= document.createElement("div");
            div_quantity.innerHTML = `<div class = "plus_minus"><button onclick ='minus("${div_id}","${id_input}", "${img_id}", "${pos_arr_pedido}")'>-</button><input type="text" readonly id = ${id_input}>
            <button onclick = 'add("${id_input}", "${pos_arr_pedido}")'>+</button></div>`;
            for (let i = 0; i<div_proteina.children.length; i++) {
                div_proteina.children[i].remove ();
            }
            img_check.remove();
            div_proteina.appendChild(div_quantity);
            const input_element = document.getElementById(`${id_input}`);
            input_element.style["font-weight"] = "bold";
            input_element.value = 1;
            input_element.style["text-align"] = "center";
            input_element.style.width = "30px";
            ///////////////////
            arr_pedido[pos_arr_pedido][1] = 1;

            for (let i = 0; i < arr_pedido.length; i++) {
                q_orders += arr_pedido[i][1];
            }
            total_price = 14000 * q_orders;
            console.log("q_orders", q_orders)

            value_order.value = `$ ${moneyFormatter.format(total_price)} COP`;
            ///
            for (let i=0; i<arr_pedido.length; i++) {
                if (arr_pedido[i][1] > 0) {
                    table += `<tr><td>${arr_pedido[i][1]}</td><td>${arr_pedido[i][0]}</td><td>$14.000</td><td>$${moneyFormatter.format(arr_pedido[i][1]*14000)}</td><td><button onclick ='cancel_order("${arr_pedido[i][2]}", "${arr_pedido[i][3]}",${arr_pedido.indexOf(arr_pedido[i])})'><img class = "cancel_product" src = "../img_proyecto/close_order.png"></button></td></tr>`; //agregué botón cancelar
                }
            }
            table += `<tr><td>----</td><td>----</td><td>--------</td><td>--------</td></tr><tr><td></td><td></td><td><b>VALOR TOTAL: </b></td><td>$${moneyFormatter.format(total_price)}</td></tr>`; 
            table_order.innerHTML = table;

        }

        function add(id_input, pos_arr_pedido) {
            let table = "<tr><th><b>Cant</b></th><th><b>Plato</b></th><th><b>$/unidad</b></th> <th><b>Valor</b></th><th><b>Cancelar</b></th></tr>"; //agregué la opcion cancelar
            const table_order = document.getElementById("table_order"); 
            let q_orders = 0; 
            let moneyFormatter  = new Intl.NumberFormat(); 
            const input_quantity = document.getElementById(id_input);
            input_quantity.style["font-weight"] = "bold"; 
            let quant_number = Number(input_quantity.value);
            const value_order = document.getElementById("value_order");
            quant_number++;
            arr_pedido[pos_arr_pedido][1] = quant_number;
            input_quantity.value = `${quant_number}`;
            for (let i = 0; i < arr_pedido.length; i++) {
                q_orders += arr_pedido[i][1];
            }
            total_price = 14000 * q_orders;

            value_order.value = `$ ${moneyFormatter.format(total_price)} COP`;
            //////////////////////
            for (let i=0; i<arr_pedido.length; i++) {
                if (arr_pedido[i][1] > 0) {
                    table += `<tr><td>${arr_pedido[i][1]}</td><td>${arr_pedido[i][0]}</td><td>$14.000</td><td>$${moneyFormatter.format(arr_pedido[i][1]*14000)}</td><td><button onclick ='cancel_order("${arr_pedido[i][2]}", "${arr_pedido[i][3]}",${arr_pedido.indexOf(arr_pedido[i])})'><img class = "cancel_product" src = "../img_proyecto/close_order.png"></button></td></tr>`; //agregué botón
                }
            }
            table += `<tr><td>----</td><td>----</td><td>--------</td><td>--------</td></tr><tr><td></td><td></td><td><b>VALOR TOTAL: </b></td><td>$${moneyFormatter.format(total_price)}</td></tr>`
            table_order.innerHTML = table;

        }

        function minus(div_id, id_input, img_id, pos_arr_pedido) {
            let table = "<tr><th><b>Cant</b></th><th><b>Plato</b></th><th><b>$/unidad</b></th> <th><b>Valor</b></th><th><b>Cancelar</b></th></tr>";
            const table_order = document.getElementById("table_order");
            const review_order = document.querySelector(".lista_pedido");
            let q_orders = 0;
            let moneyFormatter  = new Intl.NumberFormat();
            const buy_car = document.getElementById("img_car");
            const but_mi_pedido = document.getElementById("button_mi_pedido");
            const value_order = document.getElementById("value_order");
            const div_proteina = document.querySelector(`#${div_id}`);
            const input_quantity = document.getElementById(id_input);
            input_quantity.style["font-weight"] = "bold";
            let quant_number = Number(input_quantity.value);
            quant_number--;
            if (quant_number == 0) {
                for (let i = 0; i<div_proteina.children.length; i++) {
                    div_proteina.children[i].remove ();
                }
                const div_i_want = document.createElement("div");
                div_i_want.innerHTML = `<button class = "i_want" onclick="order_buy('${div_id}', '${img_id}', ${pos_arr_pedido})">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "${img_id}">`;
                div_proteina.appendChild(div_i_want);

                
            } else {
                input_quantity.value = `${quant_number}`;
            }

            arr_pedido[Number(pos_arr_pedido)][1] = quant_number;
            for (let i = 0; i < arr_pedido.length; i++) {
                q_orders += arr_pedido[i][1];
            }
            if (q_orders == 0) {
                total_price = 0;
                buy_car.style["background-color"] = "white";
                but_mi_pedido.style.visibility = "hidden";
                but_mi_pedido.style.width = "30px";
                value_order.style["background-color"] = "black";
                value_order.style.width = "30px";
                value_order.value = 0;
                review_order.style.visibility = "collapse";
                document.getElementById("first_name").value = "";
                document.getElementById("first_name").style.border = "2px solid black";
                document.getElementById("first_name").style.color = "black";
                document.getElementById("first_name").style.translate = "0px";
                document.getElementById("email").value = "";
                document.getElementById("email").style.border = "2px solid black";
                document.getElementById("email").style.color = "black";
                document.getElementById("email").style.translate = "0px";
                document.getElementById("cell_number").value = "";
                document.getElementById("cell_number").style.border = "2px solid black";
                document.getElementById("cell_number").style.color = "black";
                document.getElementById("cell_number").style.translate = "0px"

            } else {
                total_price = 14000 * q_orders;
                value_order.value = `$ ${moneyFormatter.format(total_price)} COP`; 
            }

            for (let i=0; i<arr_pedido.length; i++) {
                if (arr_pedido[i][1] > 0) {
                    table += `<tr><td>${arr_pedido[i][1]}</td><td>${arr_pedido[i][0]}</td><td>$14.000</td><td>$${moneyFormatter.format(arr_pedido[i][1]*14000)}</td><td><button onclick ='cancel_order("${arr_pedido[i][2]}", "${arr_pedido[i][3]}",${arr_pedido.indexOf(arr_pedido[i])})'><img class = "cancel_product" src = "../img_proyecto/close_order.png"></button></td></tr>`
                }
            }
            table += `<tr><td>----</td><td>----</td><td>--------</td><td>--------</td></tr><tr><td></td><td></td><td><b>VALOR TOTAL: </b></td><td>$${moneyFormatter.format(total_price)}</td></tr>`
            table_order.innerHTML = table;
             
        }

        function dropdown_order () {
            let table = "<tr><th><b>Cant</b></th><th><b>Plato</b></th><th><b>$/unidad</b></th> <th><b>Valor</b></th><th><b>Cancelar</b></th></tr>";
            let moneyFormatter  = new Intl.NumberFormat();
            const review_order = document.querySelector(".lista_pedido");
            const table_order = document.getElementById("table_order");
            const search_database = document.getElementById("search_orders");
            search_database.style.visibility = "hidden";
            for (let i=0; i<arr_pedido.length; i++) {
                if (arr_pedido[i][1] > 0) {
                    table += `<tr><td>${arr_pedido[i][1]}</td><td>${arr_pedido[i][0]}</td><td>$14.000</td><td>$${moneyFormatter.format(arr_pedido[i][1]*14000)}</td><td><button onclick ='cancel_order("${arr_pedido[i][2]}", "${arr_pedido[i][3]}",${arr_pedido.indexOf(arr_pedido[i])})'><img class = "cancel_product" src = "../img_proyecto/close_order.png"></button></td></tr>`
                }
            }
            table += `<tr><td>----</td><td>----</td><td>--------</td><td>--------</td></tr><tr><td></td><td></td><td><b>VALOR TOTAL: </b></td><td>$${moneyFormatter.format(total_price)}</td></tr>`;
            table_order.innerHTML = table;
            review_order.style.visibility = "visible";
        }

        function collapse_order() {
            const review_order = document.querySelector(".lista_pedido")
            review_order.style.visibility = "collapse";
            const search_database = document.getElementById("search_orders");
            search_database.style.visibility = "visible"
        }

        function confirm_order() {
            const i_want = document.getElementsByClassName("button_i_want");
            const button_confirm = document.getElementsByClassName("check_buy");
            const review_order = document.querySelector(".lista_pedido");
            for (let div of i_want) {
                div.style.visibility = "hidden";
            }
            button_confirm[0].style.visibility = "visible";
            review_order.style.visibility = "hidden";
            
        }

        function cancel_order(div_id, img_id, pos_arr_pedido) {
            arr_pedido[pos_arr_pedido][1] = 0; 
            let q_orders = 0;
            let moneyFormatter  = new Intl.NumberFormat();
            const review_order = document.querySelector(".lista_pedido");
            const table_order = document.getElementById("table_order");
            const buy_car = document.getElementById("img_car");
            const but_mi_pedido = document.getElementById("button_mi_pedido");
            const value_order = document.getElementById("value_order");
            const div_proteina = document.querySelector(`#${div_id}`);
            let table = "<tr><th><b>Cant</b></th><th><b>Plato</b></th><th><b>$/unidad</b></th> <th><b>Valor</b></th><th><b>Cancelar</b></th></tr>";
            

            for (let i=0; i<arr_pedido.length; i++) {
                if (arr_pedido[i][1] > 0) {
                    q_orders += arr_pedido[i][1]
                    table += `<tr><td>${arr_pedido[i][1]}</td><td>${arr_pedido[i][0]}</td><td>$14.000</td><td>$${moneyFormatter.format(arr_pedido[i][1]*14000)}</td><td><button onclick ='cancel_order("${arr_pedido[i][2]}", "${arr_pedido[i][3]}",${arr_pedido.indexOf(arr_pedido[i])})'><img class = "cancel_product" src = "../img_proyecto/close_order.png"></button></td></tr>`; //agregué botón cancelar
                }
            }
            total_price = q_orders * 14000
            table += `<tr><td>----</td><td>----</td><td>--------</td><td>--------</td></tr><tr><td></td><td></td><td><b>VALOR TOTAL: </b></td><td>$${moneyFormatter.format(total_price)}</td></tr>`; 
            table_order.innerHTML = table;

            if (q_orders == 0) {
                buy_car.style["background-color"] = "white";
                but_mi_pedido.style.visibility = "hidden";
                but_mi_pedido.style.width = "30px";
                value_order.style["background-color"] = "black";
                value_order.style.width = "30px";
                value_order.value = 0;
                review_order.style.visibility = "collapse";
                document.getElementById("first_name").value = "";
                document.getElementById("first_name").style.border = "2px solid black";
                document.getElementById("first_name").style.color = "black";
                document.getElementById("first_name").style.translate = "0px";
                document.getElementById("email").value = "";
                document.getElementById("email").style.border = "2px solid black";
                document.getElementById("email").style.color = "black";
                document.getElementById("email").style.translate = "0px";
                document.getElementById("cell_number").value = "";
                document.getElementById("cell_number").style.border = "2px solid black";
                document.getElementById("cell_number").style.color = "black";
                document.getElementById("cell_number").style.translate = "0px"
                const search_database = document.getElementById("search_orders");
                //search_database.style.visibility = "visible";

            } else {
                total_price = 14000 * q_orders;
                value_order.value = `$ ${moneyFormatter.format(total_price)} COP`; 
            }

            for (let i = 0; i<div_proteina.children.length; i++) {
                    div_proteina.children[i].remove ();
                }
                const div_i_want = document.createElement("div");
                div_i_want.innerHTML = `<button class = "i_want" id = "but_oreada" onclick="order_buy('${div_id}', '${img_id}', ${pos_arr_pedido})">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "${img_id}">`;
                div_proteina.appendChild(div_i_want);
                console.log(div_id)

        }

        function previous() {
            const i_want = document.getElementsByClassName("button_i_want");
            const list_order = document.querySelector(".lista_pedido");
            const order_form = document.querySelector(".check_buy");
            list_order.style.visibility = "visible";
            order_form.style.visibility = "collapse";
            for (let div of i_want) {
                div.style.visibility = "visible";
            }
            
        }


        function ok_my_order () {
            
            let review_table = "";
            let arr_final_order = [];
            let moneyFormatter  = new Intl.NumberFormat();
            const regex_name = /^[a-zA-Z\s]+$/; //Para comprobar nombres
            const regex_whitespace = /\S/; //Regex para comprobar que no esté vacío
            const regex_cel = /^[0-9]+$/; //regex para comprobar el número de teléfono
            const regex_email = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g; //reex para comprobar el email
            const regex_address = /^[#.0-9a-zA-Z\s,-]+$/; //reex para comprobar la dirección
            let arr_divs_verification = []; //Divs para verificar
            let arr_divs_id = []; //Array para llenar con los Id's de divs que van a moverse
            let arr_true_false = []; //Array para ubicar las verificaciones, False o True
            const confirm_div = document.querySelector(".check_buy");
            const review_order_div = document.getElementById("review_order");
            const children_confirm = confirm_div.childNodes[3].childNodes;
    
            for ( let i= 0; i <children_confirm.length; i++) {
                
                if (children_confirm[i].nodeName == "DIV") {
 
                    arr_divs_verification.push([children_confirm[i].childNodes[3].id, children_confirm[i].childNodes[3].value]);
 
                }
            }
            arr_true_false = [[arr_divs_verification[0][0], Boolean(regex_whitespace.test(arr_divs_verification[0][1])*regex_name.test(arr_divs_verification[0][1]))],
                                     [arr_divs_verification[1][0], regex_email.test(arr_divs_verification[1][1])],
                                     [arr_divs_verification[2][0], regex_cel.test(arr_divs_verification[2][1])],
                                     [arr_divs_verification[3][0], Boolean(regex_whitespace.test(arr_divs_verification[3][1])*regex_address.test(arr_divs_verification[3][1]))]]

            arr_true_false.forEach((elem) => {
                if (elem[1] == false) {
                    arr_divs_id.push(elem[0])
                }
            })
            if (arr_divs_id.length >0) {
                vibrate (arr_divs_id);
            } else {
                let now = new Date();
                id_order++;
                review_table = `<b>N° Factura:</b> ${id_order}<br>
                         <b>Nombre:</b> ${arr_divs_verification[0][1]}<br>
                         <b>Email:</b> ${arr_divs_verification[1][1]}<br>
                         <b>Celular:</b> ${arr_divs_verification[2][1]}<br>
                         <b>Dirección:</b> ${arr_divs_verification[3][1]}<br>
                         <b>Observaciones:</b> <em>${document.getElementById("commit").value}</em><br>
                         <b>Pedido:</b><br>` 
                for (let k = 0; k<arr_pedido.length; k++) {
                    if (arr_pedido[k][1] > 0) {
                        arr_final_order.push(arr_pedido[k].slice(0,2));
                        review_table += `-- ${arr_pedido[k][1]}  ${arr_pedido[k][0]}<br>`;
                        //arr_pedido[k][1] = 0;
                    }
                }

                alert("Pedido registrado con éxito!");
                review_table += `<b>Precio:</b> $${moneyFormatter.format(total_price)} COP<br><b>Fecha:</b> ${now.toLocaleString()}<br>`
                document.getElementById("review_paragraph").innerHTML = review_table;
                review_order_div.style.visibility = "visible";
                confirm_div.style.visibility = "hidden";
                document.getElementById("button_mi_pedido").style.visibility = "hidden";
                

                //Montar el pedido en la base de datos
                data = {
                    "id" : `${id_order}`,
                    "name" : `${arr_divs_verification[0][1]}`,
                    "email" : `${arr_divs_verification[1][1]}`,
                    "celular" : `${arr_divs_verification[2][1]}`,
                    "direccion" : `${arr_divs_verification[2][1]}`,
                    "observaciones" : `${document.getElementById("commit").value}`,
                    "pedido" : arr_final_order,
                    "precio" : moneyFormatter.format(total_price),
                    "modo" : "delivery",
                    "Fecha" : `${now.toLocaleString()}`
                }

                

                //---------------------------------

                   
            }
        }

        function finish () {
            document.getElementById("review_paragraph").innerHTML = "";
            document.getElementById("review_order").style.visibility = "hidden";
            document.getElementById("first_name").value = "";
            document.getElementById("email").value = "";
            document.getElementById("cell_number").value = "";
            document.getElementById("dir").value = "";
            document.getElementById("commit").value = "";

            const divs_i_want = document.querySelectorAll(".button_i_want");
            const buy_car = document.getElementById("img_car");
            const but_mi_pedido = document.getElementById("button_mi_pedido");
            const value_order = document.getElementById("value_order");

            arr_pedido.forEach((elem) => {
                if (elem[1] > 0) {
                    document.getElementById(elem[2]).innerHTML = `<button class = "i_want" id = "but_oreada" onclick="order_buy('${elem[2]}', '${elem[3]}', ${arr_pedido.indexOf(elem)})">Yo quiero!</button>
                <img src="../img_proyecto/check_order.png" alt="" id = "${elem[3]}">`;
                    elem[1] = 0;
                }
                
            })
            
            for (let div of divs_i_want) {
                div.style.visibility = "visible";
            }

            buy_car.style["background-color"] = "white";
            but_mi_pedido.style.visibility = "hidden";
            but_mi_pedido.style.width = "30px";
            value_order.style["background-color"] = "black";
            value_order.style.width = "30px";
            value_order.value = 0;



            //Montar en la base de datos
            fetch ('http://localhost:3000/orders', {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-type' : 'application/json; charset=UTF-8'
                    },
                })
                .then(response => response.json())
                .then(json => console.log(json))
                .catch(error => console.error("ERROR!!!:" + error))
        }

        /*BUSCAR EN LA BASE DE DATOS*/

        document.getElementById("search_orders").addEventListener("click", () => {
            let query;
            const regex_info = /^[0-9]+$/; //solo numeros
            const button_mi_pedido = document.getElementById("button_mi_pedido");
            button_mi_pedido.style.visibility = "hidden";
            const option = document.getElementById("option_search").value;
            const input_info = document.getElementById("input_database").value;
            if (option == "id") {
                query = `http://localhost:3000/orders?id=${input_info}`
            } else {
                query = `http://localhost:3000/orders?celular=${input_info}`
            }
            fetch (query, {
                method: 'GET',
                headers: {
                    'Content-type' : 'application/json; charset=UTF-8'
                },
            })
            .then(response => response.json())
            .then(json => {
                
                let num_pos = 0;
                let factura = "";
                const div_list = document.getElementById("each_order");
                const table_orders = document.querySelector(".info_database");
                const close_order = document.getElementById("close_order");
                const before_order = document.getElementById("before_order");
                const after_order = document.getElementById("after_order");
                table_orders.style.visibility = "visible";
                close_order.style.visibility = "visible";

                /*Permitir que el botón close cierre*/
                close_order.addEventListener("click", () => {
                    console.log(total_price)
                    table_orders.style.visibility = "hidden"
                    close_order.style.visibility = "hidden";
                    before_order.style.visibility = "hidden";
                    after_order.style.visibility = "hidden";
                    document.getElementById("input_database").value = "";
                    if (total_price > 0) {
                        button_mi_pedido.style.visibility = "visible";
                    } else if (total_price === 0) {
                        button_mi_pedido.style.visibility = "hidden";
                    }
                })

                /*Permitir que el botón hacia ADELANTE funcione*/
                after_order.addEventListener("click", () => {
                    num_pos++;
                    if (num_pos >= json.length - 1) {
                        after_order.style.visibility = "hidden";
                        before_order.style.visibility = "visible";

                        factura = `<b>N° Factura:</b> ${json[num_pos].id}<br>
                            <b>Nombre:</b> ${json[num_pos].name}<br>
                            <b>Email:</b> ${json[num_pos].email}<br>
                            <b>Celular:</b> ${json[num_pos].celular}<br>
                            <b>HDirección:</b> ${json[num_pos].direccion}<br>
                            <b>Observaciones:</b> <em>${json[num_pos].observaciones}</em><br>
                            <b>Pedido:</b><br>`;

                        for (let k = 0 ; k < json[num_pos].pedido.length; k++) {
                            factura += `-- ${json[num_pos].pedido[k][1]} ${json[num_pos].pedido[k][0]}<br>`;
                        }

                        factura += `<b>Precio:</b> $${json[num_pos].precio} COP<br>
                                    <b>modo:</b> ${json[num_pos].modo}<br>
                                    <b>Fecha:</b> ${json[num_pos].Fecha}<br>`;
                        
                        div_list.innerHTML =factura;

                        num_pos = json.length - 1;


                    } else {
                        
                        factura = `<b>N° Factura:</b> ${json[num_pos].id}<br>
                            <b>Nombre:</b> ${json[num_pos].name}<br>
                            <b>Email:</b> ${json[num_pos].email}<br>
                            <b>Celular:</b> ${json[num_pos].celular}<br>
                            <b>Hora recoger:</b> ${json[num_pos].hora}<br>
                            <b>Observaciones:</b> <em>${json[num_pos].observaciones}</em><br>
                            <b>Pedido:</b><br>`;

                        for (let k = 0 ; k < json[num_pos].pedido.length; k++) {
                            factura += `-- ${json[num_pos].pedido[k][1]} ${json[num_pos].pedido[k][0]}<br>`;
                        }

                        factura += `<b>Precio:</b> $${json[num_pos].precio} COP<br>
                                    <b>modo:</b> ${json[num_pos].modo}<br>
                                    <b>Fecha:</b> ${json[num_pos].Fecha}<br>`;
                        
                        div_list.innerHTML =factura;

                    }
                    
                })

                /*Permitir que el botón hacia ATRÁS funcione*/
                before_order.addEventListener("click", () => {
                        num_pos--;
                    if (num_pos <= 0) {
                        before_order.style.visibility = "hidden";
                        after_order.style.visibility = "visible";

                        factura = `<b>N° Factura:</b> ${json[num_pos].id}<br>
                            <b>Nombre:</b> ${json[num_pos].name}<br>
                            <b>Email:</b> ${json[num_pos].email}<br>
                            <b>Celular:</b> ${json[num_pos].celular}<br>
                            <b>Hora recoger:</b> ${json[num_pos].hora}<br>
                            <b>Observaciones:</b> <em>${json[num_pos].observaciones}</em><br>
                            <b>Pedido:</b><br>`;

                        for (let j = 0 ; j < json[num_pos].pedido.length; j++) {
                            factura += `-- ${json[num_pos].pedido[j][1]} ${json[num_pos].pedido[j][0]}<br>`;
                        }

                        factura += `<b>Precio:</b> $${json[num_pos].precio} COP<br>
                                    <b>modo:</b> ${json[num_pos].modo}<br>
                                    <b>Fecha:</b> ${json[num_pos].Fecha}<br>`;
                        
                        div_list.innerHTML =factura;

                        num_pos = 0;
                    } else {
                        
                        factura = `<b>N° Factura:</b> ${json[num_pos].id}<br>
                            <b>Nombre:</b> ${json[num_pos].name}<br>
                            <b>Email:</b> ${json[num_pos].email}<br>
                            <b>Celular:</b> ${json[num_pos].celular}<br>
                            <b>Hora recoger:</b> ${json[num_pos].hora}<br>
                            <b>Observaciones:</b> <em>${json[num_pos].observaciones}</em><br>
                            <b>Pedido:</b><br>`;

                        for (let j = 0 ; j < json[num_pos].pedido.length; j++) {
                            factura += `-- ${json[num_pos].pedido[j][1]} ${json[num_pos].pedido[j][0]}<br>`;
                        }

                        factura += `<b>Precio:</b> $${json[num_pos].precio} COP<br>
                                    <b>modo:</b> ${json[num_pos].modo}<br>
                                    <b>Fecha:</b> ${json[num_pos].Fecha}<br>`;
                        
                        div_list.innerHTML =factura;

                    }
                    
                })



                
                if (json.length == 0 || regex_info.test(input_info) == false ) {
                    div_list.innerHTML = "<em>NO HAY INFORMACIÓN PARA MOSTRAR</em>";
                    before_order.style.visibility = "hidden";
                    after_order.style.visibility = "hidden";
                } else if (json.length === 1) {
                    
                    document.getElementById("before_order").style.visibility = "hidden";
                    document.getElementById("after_order").style.visibility = "hidden";
                    factura = `<b>N° Factura:</b> ${json[0].id}<br>
                        <b>Nombre:</b> ${json[0].name}<br>
                        <b>Email:</b> ${json[0].email}<br>
                         <b>Celular:</b> ${json[0].celular}<br>
                         <b>Hora recoger:</b> ${json[0].hora}<br>
                         <b>Observaciones:</b> <em>${json[0].observaciones}</em><br>
                         <b>Pedido:</b><br>`;

                    for (let i = 0 ; i < json[0].pedido.length; i++) {
                        factura += `-- ${json[0].pedido[i][1]} ${json[0].pedido[i][0]}<br>`;
                    }

                    factura += `<b>Precio:</b> $${json[0].precio} COP<br>
                                <b>modo:</b> ${json[0].modo}<br>
                                <b>Fecha:</b> ${json[0].Fecha}<br>`;
                    
                    div_list.innerHTML =factura;
 
                } else {
                    console.log(json);
                    before_order.style.visibility = "hidden";
                    after_order.style.visibility = "visible";
                    factura = `<b>N° Factura:</b> ${json[0].id}<br>
                        <b>Nombre:</b> ${json[0].name}<br>
                        <b>Email:</b> ${json[0].email}<br>
                         <b>Celular:</b> ${json[0].celular}<br>
                         <b>Hora recoger:</b> ${json[0].hora}<br>
                         <b>Observaciones:</b> <em>${json[0].observaciones}</em><br>
                         <b>Pedido:</b><br>`;

                    for (let m = 0 ; m < json[0].pedido.length; m++) {
                        factura += `-- ${json[0].pedido[m][1]} ${json[0].pedido[m][0]}<br>`;
                    }

                    factura += `<b>Precio:</b> $${json[0].precio} COP<br>
                                <b>modo:</b> ${json[0].modo}<br>
                                <b>Fecha:</b> ${json[0].Fecha}<br>`;
                    
                    div_list.innerHTML =factura;
                }
                

            })

            
        })

        document.getElementById("stack_icon").addEventListener("mouseover", () => {
            if (total_price == 0) {
                document.getElementById("search_orders").style.visibility = "visible";
            } 
        })
 
 
     </script>
    
</body>
</html>