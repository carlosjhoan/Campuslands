<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PERFUMERÍA ACME</title>
    
    <style>
        nav {
            padding: 10px;
            height: 50px;
            background-color: aliceblue;
            box-shadow: 0 0 2px 2px rgb(161, 161, 161, 0.7);
            border-radius: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;

        }

        nav label {
            font-weight: bold;
        }

        nav input {
            text-align: center;
            height: 25px;
            border-radius: 25px;
            border: 1px solid black;
        }
        #funct_table {
            padding: 10px;
            height: 60px;
            visibility: collapse;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(240, 187, 187, 0.5);
            border-radius: 20px;
            box-shadow: 0 0 2px 2px rgb(161, 161, 161, 0.7);
        }
        #funct_table label {
            font-weight: bold;
        }

        #funct_table input {
            height: 20px;
            border: 2px solid black;
            border-radius: 20px;
            text-align: center;
        }

        #funct_table button {
            height: 25px;
            border-radius: 25px;
            border: 1px solid rgb(5, 5, 5);
            background-color: rgb(5, 5, 5);
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        #funct_table button:hover {
            border: 1px solid rgb(5, 5, 5, 0.7);
            background-color: rgb(5, 5, 5, 0.7);
        }



        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content:first baseline;
            gap: 20px;
        }

        #registro {
            padding: 10px;
            height: 120px;
            width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            background-color: antiquewhite;
            border-radius: 20px;
            box-shadow: 0 0 5px 5px rgb(161, 161, 161, 0.7);
        }

        #registro input {
            height: 20px;
            border: 2px solid black;
            border-radius: 20px;
            text-align: center;
        }

        #registro button {
            height: 25px;
            border-radius: 25px;
            border: 1px solid green;
            background-color: green;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        #registro select {
            width: 170px;
            height: 25px;
            border: 2px solid black;
            border-radius: 25px;
            text-align: center;
        }

        #registro button:hover {
            border: 1px solid rgb(4, 126, 4, 0.7);
            background-color: rgb(4, 126, 4, 0.7);
        }

        /*INFO CLIENTE*/

        #info_cliente {
            visibility: collapse;
            position: fixed;
            height: 500px;
            width: 375px;
            top: 0%;
            background-color: rgb(236, 207, 207);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly;
            border-radius: 0 0 20px 20px;
        }
        .info {
            height: 400px;
        }

        /*NUEVO CLIENTE Y COMPRA*/
        #registrar_compra {
            padding: 10px;
            height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            background-color: rgba(121, 162, 163);
            border-radius: 20px;
            position: fixed;
            top: 0%;
            visibility: hidden;
        }

        /*COMPRA*/
        #new_cliente {
            height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            border-bottom: 1px solid black;
            visibility: hidden;
        }

        #select_compra {
            visibility: hidden;
        }
        
        
     
        
    /*CLASS LOGIN*/
    .login {
        width: 100%;
        display: flex;
        justify-content:space-between;
    }


    </style>
</head>
<body>

    <!--INFORMACiÓN DE USUARIO-->
    <nav>
        <label for="user_name" id = "label_user_name"></label>
        <input type="text" id = "user_name" readonly>
    </nav>



    <!--REGISTRO-->
    <div id = "registro">
        <div class="login">
            <label for="type_user">Tipo de usuario:</label>
        <select name="user_type" id="type_user">
            <option value="2">Funcionario</option>
            <option value="3">Cliente</option>
            <option value="1">Administrador</option>
        </select>
        </div>

        <div class="login">
            <label for="user_id">Usuario:</label>
            <input type="text" id ="user_id">
        </div>

        <div class="login">
            <label for="user_pass">Contraseña:</label>
            <input type="password" id ="user_pass">
        </div>


        <button id = "but_login"> Ingresar</button>
        
    </div>

    <!------------->


    <!--FUNCIONARIO PUEDE BUSCAR CLIENTE-->

    <div id = "funct_table">
        <div class="login">
            <label for="cod_cliente">Cod Cliente</label>
            <input type="number" id ="cod_cliente">
        </div>
        <button id = "but_consultar">Consultar</button>
    </div>

    <!------------->

    <!--FUNCIONARIO PUEDE BUSCAR CLIENTE-->

    <div id = "info_cliente">
        <div class="info">
            <div id = "cliente_info_text">

            </div>
        </div>
        
        
        <div class = "buttons_info_cliente">
            <button id = "but_compra">Registrar compra</button>
            <button id = "but_bono">BONO</button>
            <button id = "close">cerrar</button>
        </div>
    </div>

    <!--REGISTRAR NUEVO CLIENTE Y COMPRAR-->
        <div id = "registrar_compra">
            <div id = "new_cliente">

                <div class="login">
                    <label for="new_id">Doc. Identidad</label>
                    <input type="number" id ="new_id" readonly>
                </div>
    
                <div class="login">
                    <label for="new_name">Nombre</label>
                    <input type="text" id ="new_name">
                </div>
        
                <div class="login">
                    <label for="new_pass" id = "label_new_pass">Contraseña</label>
                    <input type="password" id ="new_pass">
                </div>
                <button id = "but_new_cliente">LISTO!</button>
    
            </div>

            <div id = "select_compra">
                <label for="perfumes">Selec. Perfume</label>
                <select name="perf" id="perfumes">
                    <option value="1">Perfume A</option>
                    <option value="2">Perfume B</option>
                    <option value="3">Perfume C</option>
                    <option value="4">Perfume D</option>
                    <option value="5">Perfume E</option>
                    <option value="6">Perfume F</option>
                    <option value="7">Perfume G</option>
                    <option value="8">Perfume H</option>
                    <option value="9">Perfume I</option>
                    <option value="10">Perfume J</option>
                </select>
                <button id = "comprar">Comprar!</button>
            </div>

            
        </div>
        



    <script>

        // Funcionalidad del login

        document.getElementById("but_login").addEventListener("click", () => {
            const user_type = document.getElementById("type_user").value;
            const user_id = document.getElementById("user_id").value;
            const user_pass = document.getElementById("user_pass").value;

            fetch (`http://localhost:4001/usuarios?id=${user_id}`, {
                method: 'GET',
                headers: {
                    'Content-type' : 'application/json; charset=UTF-8'
                },
            })
            .then(response => response.json())
            .then(json => {
                if (json.length >0 ) {
                    if (json[0].pass == user_pass &&  json[0].tipoId == user_type) {
                        alert("Información correcta!");
                        if (json[0].tipoId == "3") {
                            document.getElementById("label_user_name").innerHTML = "Cliente   ";
                            document.getElementById("funct_table").style.visibility = "collapse";
                            document.getElementById("user_name").value = user_id;
                            document.getElementById("user_id").value = "";
                            document.getElementById("user_pass").value = ""
                        } else {
                            document.getElementById("label_user_name").innerHTML = "Funcionario   ";
                            document.getElementById("funct_table").style.visibility = "visible";
                            document.getElementById("user_name").value = user_id;
                            document.getElementById("user_id").value = "";
                            document.getElementById("user_pass").value = ""

                        }
                        



                    } else {
                        alert("Información errónea. Intente de nuevo");
                        document.getElementById("user_id").value = "";
                        document.getElementById("user_pass").value = ""
                    }

                } else {
                    alert("Usuario no registrado");
                    document.getElementById("user_id").value = "";
                    document.getElementById("user_pass").value = ""
                }
            })

        })

        
        // Funcionalidad del botón consultar
        document.getElementById("but_consultar").addEventListener("click",() => {
            const cod_cliente = document.getElementById("cod_cliente").value;
            
            fetch (`http://localhost:4001/usuarios?id=${cod_cliente}`, {
                method: 'GET',
                headers: {
                    'Content-type' : 'application/json; charset=UTF-8'
                },
            })
            .then(response => response.json())
            .then(json => {
                if(json.length == 0) {
                    document.getElementById("info_cliente").style.visibility = "visible";
                    document.getElementById("cliente_info_text").innerHTML = "CLIENTE NO REGISTRADO";
                    document.getElementById("but_bono").style.visibility = "collapse";

                } else if (json.length > 0 && json[0].tipoId == "2"){
                    alert("Este registro corresponde a un Funcionario");
                    document.getElementById("cod_cliente").value = "";
                } else if (json.length > 0 && json[0].tipoId == "1"){
                    alert("Este registro corresponde a un Administrativo");
                    document.getElementById("cod_cliente").value = "";
                }
                
                else {
                    //MUCHO POR HACER ACÁ
                    fetch (`http://localhost:4001/registros?usuarioId=${cod_cliente}`, {
                        method: 'GET',
                        headers: {
                            'Content-type' : 'application/json; charset=UTF-8'
                        },
                    })
                    .then(response => response.json())
                    .then(json => {
                        console.log(json)
                        if (json.length == 0) {
                            document.getElementById("info_cliente").style.visibility = "visible";
                            document.getElementById("cliente_info_text").innerHTML = "CIENTE NO REGISTRA COMPRAS";
                            document.getElementById("but_bono").style.visibility = "collapse";
                            document.getElementById("select_compra").style.visibility = "collapse";
                            document.getElementById("registrar_compra").style.visibility = "collapse";
                        }
                    })
                }


            })
        })

        // Funcionalidad del botón CERRAR
        document.getElementById("close").addEventListener("click", () => {
            document.getElementById("info_cliente").style.visibility = "collapse";
            document.getElementById("select_compra").style.visibility = "collapse";
            document.getElementById("registrar_compra").style.visibility = "collapse";
            document.getElementById("new_cliente").style.visibility = "collapse"
        })

        //REGISTRAR COMPRA
        document.getElementById("but_compra").addEventListener("click", () => {
            const cod_cliente = document.getElementById("cod_cliente").value;
            fetch (`http://localhost:4001/usuarios?id=${cod_cliente}`, {
                method: 'GET',
                headers: {
                    'Content-type' : 'application/json; charset=UTF-8'
                },
            })
            .then(response => response.json())
            .then(json => {
                if(json.length == 0) {
                    document.getElementById("registrar_compra").style.visibility = "visible";
                    document.getElementById("new_cliente").style.visibility = "visible";
                    document.getElementById("new_id").value = document.getElementById("cod_cliente").value;
                    document.getElementById("but_new_cliente").style.visibility = "visible";
                    document.getElementById("new_pass").style.visibility = "visible";
                    document.getElementById("label_new_pass").style.visibility = "visible";
                    
                    
                    

                } else {
                    document.getElementById("new_cliente").style.visibility = "collapse";
                    document.getElementById("select_compra").style.visibility = "visible";
                    document.getElementById("registrar_compra").style.visibility = "visible";
                    
                }

            })

        })

        //Botón listo

        document.getElementById("but_new_cliente").addEventListener("click", () => {
            const new_id = document.getElementById("new_id").value;
            const new_name = document.getElementById("new_name").value;
            const new_pass = document.getElementById("new_pass").value;
            let data = {};
            if (new_name !="" && new_pass != "") {
                
                document.getElementById("select_compra").style.visibility = "visible";
                document.getElementById("but_new_cliente").style.visibility = "hidden";
                document.getElementById("new_pass").style.visibility = "hidden";
                document.getElementById("label_new_pass").style.visibility = "hidden";

                alert(`${new_name}, Bienvenido a Perfumería ACME`);  
            }
        });

        //BOTÓN COMPRAR
        document.getElementById("comprar").addEventListener("click", () => {
                let data_login;
                let compra;
                console.log(document.getElementById("new_cliente").style.visibility)
                if (document.getElementById("new_cliente").style.visibility == "visible") {
                    const new_id = document.getElementById("new_id").value;
                    const new_name = document.getElementById("new_name").value;
                    const new_pass = document.getElementById("new_pass").value;
                    data = {
                    "id" : `${new_id}`,
                    "pass" : `${new_pass}`,
                    "nombre" : `${new_name}`,
                    "tipoId" : "3"
                    };
                    

                    fetch ('http://localhost:4001/registros', {
                        method: 'GET',
                        headers: {
                            'Content-type' : 'application/json; charset=UTF-8'
                        },
                    })
                    .then(response => response.json())
                    .then(json =>() => {
                        console.log("json", json);
                        if (json.length == 0) {
                            id_registro = 1;
                        }else {
                            id_registro = json.length;
                            id_registro++;
                        }
                        alert(`id es ${id_registro}`);
                        data_registro = {
                            "id" : `${id_registro}`,
                            "usuarioId" : `${new_id}`,
                            "compra" : [{
                                "fecha" : `${now.toLocaleString()}`,
                                "perfumeId" : `${document.getElementById("perfumes").value}`
                            }]
                        }
                    })

                        /*fetch ('http://localhost:4001/usuarios', {
                            method: 'POST',
                            body: JSON.stringify(data_login),
                            headers: {
                                'Content-type' : 'application/json; charset=UTF-8'
                            },
                        })
                        .then(response => response.json())
                        .then(json => () => {
                            
                        })
                        .catch(error => console.error("ERROR!!!:" + error))


                        fetch ('http://localhost:4001/registros', {
                                method: 'POST',
                                body: JSON.stringify(data_registro),
                                headers: {
                                    'Content-type' : 'application/json; charset=UTF-8'
                                },
                            })
                            .then(response => response.json())
                            .then(json => console.log(json))
                            .catch(error => console.error("ERROR!!!:" + error))*/
                        alert("Registro de compra exitoso");
      
                } else {
                        alert("Estoy en otro cliente"); 
                    }

                    

                    

                })

            

            



            



        

    </script>


</body>
</html>